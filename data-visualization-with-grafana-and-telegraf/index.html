<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Data visualization with Grafana and Telegraf - Zoltán's Blog</title><meta name=description content="There are decades where nothing happens; and there are weeks where decades happen."><meta name=author content="map[email:zoltan.balogh@suse.com github:bzoltan1 linkedin:zbalogh name:Zoltán Balogh]"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Zoltán\u0027s Blog","url":"https:\/\/bzoltan1.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/bzoltan1.github.io\/"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/bzoltan1.github.io\/","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/bzoltan1.github.io\/data-visualization-with-grafana-and-telegraf\/","name":"Data visualization with grafana and telegraf"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Zoltán Balogh"},"headline":"Data visualization with Grafana and Telegraf","description":"It all started when\u0026hellip; Few weeks ago we have decided to create a dashboard where we can monitor the status of the SUSE Linux Enterprise maintenance update queue. Naturally there are tons of cool open source solutions to build this type of monitoring. Two decades ago I probably would have written a Perl or Python based monitoring script for the monitoring part and use the good old gnuplot (http:\/\/www.gnuplot.info\/) to visualize the data and create an active page written in some silly web UI framework. Let\u0026rsquo;s just say that luckily those times has passed.\n","inLanguage":"en","wordCount":1044,"datePublished":"2022-10-06T20:32:50\u002b03:00","dateModified":"2022-10-06T20:32:50\u002b03:00","image":"https:\/\/bzoltan1.github.io\/avatar.png","keywords":["Grafana, InfluxDB, Telegraf, opens source, openSUSE, Linux"],"mainEntityOfPage":"https:\/\/bzoltan1.github.io\/data-visualization-with-grafana-and-telegraf\/","publisher":{"@type":"Organization","name":"https:\/\/bzoltan1.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/bzoltan1.github.io\/avatar.png","height":60,"width":60}}}</script><meta property="og:title" content="Data visualization with Grafana and Telegraf"><meta property="og:description" content="There are decades where nothing happens; and there are weeks where decades happen."><meta property="og:image" content="https://bzoltan1.github.io/avatar.png"><meta property="og:url" content="https://bzoltan1.github.io/data-visualization-with-grafana-and-telegraf/"><meta property="og:type" content="website"><meta property="og:site_name" content="Zoltán's Blog"><meta name=twitter:title content="Data visualization with Grafana and Telegraf"><meta name=twitter:description content="There are decades where nothing happens; and there are weeks where decades happen."><meta name=twitter:image content="https://bzoltan1.github.io/avatar.png"><meta name=twitter:card content="summary_large_image"><link href=https://bzoltan1.github.io/avatar.png rel=icon type=image/x-icon><meta name=generator content="Hugo 0.147.5"><link rel=alternate href=https://bzoltan1.github.io/index.xml type=application/rss+xml title="Zoltán's Blog"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://bzoltan1.github.io/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel=stylesheet href=https://bzoltan1.github.io/css/syntax.css><link rel=stylesheet href=https://bzoltan1.github.io/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://bzoltan1.github.io/>Zoltán's Blog</a></div><div class="collapse navbar-collapse" id=main-navbar><ul class="nav navbar-nav navbar-right"><li><a title=Blog href=https://bzoltan1.github.io/>Blog</a></li><li><a title=Tags href=https://bzoltan1.github.io/tags>Tags</a></li><li><a title=Home href=https://bzoltan1.github.io/>Home</a></li><li><a title=About href=https://bzoltan1.github.io/about>About</a></li></ul></div><div class=avatar-container><div class=avatar-img-border><a title="Zoltán's Blog" href=https://bzoltan1.github.io/><img class=avatar-img src=https://bzoltan1.github.io/avatar.png alt="Zoltán's Blog"></a></div></div></div></nav><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header class=header-section><div class="intro-header no-img"><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class=post-heading><h1>Data visualization with Grafana and Telegraf</h1><h2 class=post-subheading>There are decades where nothing happens; and there are weeks where decades happen.</h2><span class=post-meta><i class="fas fa-calendar"></i>&nbsp;Posted on October 6, 2022
&nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Zoltán Balogh</span></div></div></div></div></div></header><div class=container role=main><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><article role=main class=blog-post><h3 id=it-all-started-when>It all started when&mldr;</h3><p>Few weeks ago we have decided to create a dashboard where we can monitor the status of the SUSE Linux Enterprise maintenance update queue. Naturally there are tons of cool open source solutions to build this type of monitoring. Two decades ago I probably would have written a Perl or Python based monitoring script for the monitoring part and use the good old gnuplot (<a href=http://www.gnuplot.info/>http://www.gnuplot.info/</a>) to visualize the data and create an active page written in some silly web UI framework. Let&rsquo;s just say that luckily those times has passed.</p><p>I have turned to the development team of the openQA and asked them what do they use for their monitoring system. It is a really good open source practice to use the technology what our friends are using so we can ask for help and we can later contribute to their projects.</p><p>I have learned that the openQA monitor is based on the Grafana - InfluxDB - Telegraf chain. At first it seemed a bit too complex, but looking closer how this pipleline works I started to like it. After we were ready with the dashboard I decided to write up the key steps and most important learning so I will not forget it so easily and I can share with anybody who may need to create similar tool.</p><h3 id=first-lets-walk-through-the-main-components>First let&rsquo;s walk through the main components</h3><ul><li><a href=https://github.com/grafana/grafana>Grafana</a> is a multi-platform open source analytics and interactive visualization web application. It provides charts, graphs, and alerts for the web when connected to supported data sources.</li><li><a href=https://github.com/influxdata/influxd>InfluxDB</a> is an open-source time series database developed by the company InfluxData. It is written in the Go programming language for storage and retrieval of time series data in fields such as operations monitoring, application metrics, Internet of Things sensor data, and real-time analytics.</li><li><a href=https://github.com/influxdata/telegraf>Telegraf</a> is an open source plugin-driven server agent for collecting and reporting metrics.</li></ul><p>The installation step on openSUSE TumbleWeed were the following</p><pre tabindex=0><code>sudo zypper install grafana
</code></pre><p>The <a href=https://grafana.com/docs/grafana/latest/setup-grafana/installation/rpm>official installation instructions</a> are pretty clear and straight forward.</p><p>There is not much hack around, most of the steps are really next-next-finish. Most of the time with this step I have wasted on configuring my haproxy and creating certificates for my own grafana service.</p><p>To start the Grafana service and verify that the service has started I needed these steps</p><pre tabindex=0><code>sudo systemctl daemon-reload
sudo systemctl start grafana-server
sudo systemctl status grafana-server
</code></pre><p>And I have configured the Grafana server to start at boot:</p><pre tabindex=0><code>sudo systemctl enable grafana-server
</code></pre><p>I have opened the Web UI of the Grafana and logged in login with the default admin:admin credentials. Naturally I have changed the password to a strong one.</p><p>In the Grafana web UI I went to the &ldquo;Add data source&rdquo; and selected InfluxDB. The configuration there is pretty obvious. Setting the user credentials for the database is essential. But the UI has a &ldquo;test&rdquo; feature, so it is basically impossible to set up the database wrong.</p><p>During this step I had to install and set up the InfluxDB. That was yet again so easy that I was sure I am doing something wrong.</p><pre tabindex=0><code>zypper install influxdb
systemctl start influxdb
systemctl status influxdb
systemctl enable grafana-server
</code></pre><p>At this point I refused to be the victim of the &ldquo;everything must be configured with a web UI movement&rdquo; so I have not even touched the InfluxDB web UI. Most likely this part is necessary if somebody wants to use InfluxDB for a more complex use case. But I knew that I all need is feeding the database with simple records in time series.</p><p>In the <code>/etc/influxdb/config.toml</code> I have changed the value of auth-enabled from false to true and remove the leading # symbol from the line to uncomment the setting as shown below.</p><pre tabindex=0><code>...
[http]
  ...
  # Determines whether user authentication is enabled over HTTP/HTTPS.
  auth-enabled = true
...
</code></pre><p>Save and close the file. Next, restart the influxdb service to load the new security setting.</p><pre tabindex=0><code>sudo systemctl restart influxdb
</code></pre><p>After that I could log in to the InfluxDB server with the admin username and password that you created above by executing the following command.</p><pre tabindex=0><code>$ influx -username &#39;admin&#39; -password &#39;***&#39;
</code></pre><p>I am not sure if was necessary but I have created the telegraf database.</p><pre tabindex=0><code>influx -username &#39;admin&#39; -password &#39;***&#39;
  CREATE DATABASE &#34;telegraf&#34; WITH DURATION 17280h
</code></pre><p>I have heard opinions that on the first telegraf push the database server would have created the table automagically. That I can not confirm, but at last I know that creating manually the database is not harmful.</p><p>The next and almost final step is to install and configure the Telegraf service</p><pre tabindex=0><code>zypper install telegraf
</code></pre><p>Then I configured it by editing the <code>/etc/telegraf/telegraf.conf</code></p><pre tabindex=0><code>[global_tags]
[[outputs.influxdb]]
  urls = [&#34;http://127.0.0.1:8086&#34;]
  database = &#34;telegraf&#34;
  username = &#34;admin&#34;
  password = &#34;***&#34;
  user_agent = &#34;telegraf/osd&#34;
[[inputs.exec]]
  commands = [ &#39;/etc/telegraf/scripts/load.sh&#39; ]
  interval = &#34;10s&#34;
  timeout = &#34;10s&#34;
  data_format = &#34;influx&#34;
</code></pre><p>The <a href=https://github.com/os-autoinst/salt-states-openqa/tree/master/monitorin>SaLt State files of the openQA&rsquo;s monitoring system</a> served as template.</p><p>The <code>/etc/telegraf/scripts/load.sh</code> is a simple oneliner to return cpu, memory and storage status of the root</p><pre tabindex=0><code>#!/bin/bash
echo &#34;load,machine=grafana.localhost  cpu=`LC_ALL=C top -bn1 | grep &#34;Cpu(s)&#34; | sed &#34;s/.*, *\([0-9.]*\)%* id.*/\1/&#34; | awk &#39;{print 100 - $1}&#39;`,memory=`free -m | awk &#39;/Mem:/ { printf(&#34;%3.1f&#34;, $3/$2*100) }&#39;`,disk=`df -h / | awk &#39;/\// {print $(NF-1)}&#39;|sed &#39;s/\%//g&#39;`&#34;
</code></pre><p>Then start the telegraf service</p><pre tabindex=0><code>systemctl start telegraf
systemctl status telegraf
systemctl enable telegraf
</code></pre><p>The telegraf configuration can be tested with a single command</p><p><code>telegraf --config telegraf.conf --test</code></p><p>At this point I must note that Telegraf is pretty annoying when it comes to the data format of the inputs.exec plugin. One must be super careful with all the commas, white spaces and data types while Telegraf is not very communicative when it comes to explaining what is wrong with the output of the executed command. Anyhow, I got it right after some attempts, but I am not pleased with that part.</p><p>The rest is UI tossing in the Grafana web UI. Creating a new dashboard and adding new panels, setting up the data source and making it look pretty.</p><p><img src=https://bzoltan1.github.io/Grafana-screenshot.png alt="Grafana screenshot with resource usage of a Linux system"></p><p>Really easy. My overall view is that setting up this toolchain is pretty simple, well documented and easy to use. If I need to set up monitoring smart devices, sensors or server statuses I will definitely will use Grafana and Telegraf.</p><div class=blog-tags><a href=https://bzoltan1.github.io/tags/grafana/>Grafana</a>&nbsp;
<a href=https://bzoltan1.github.io/tags/influxdb/>InfluxDB</a>&nbsp;
<a href=https://bzoltan1.github.io/tags/telegraf/>Telegraf</a>&nbsp;
<a href=https://bzoltan1.github.io/tags/opens-source/>opens source</a>&nbsp;
<a href=https://bzoltan1.github.io/tags/opensuse/>openSUSE</a>&nbsp;
<a href=https://bzoltan1.github.io/tags/linux/>Linux</a>&nbsp;</div></article><ul class="pager blog-pager"><li class=previous><a href=https://bzoltan1.github.io/audio-controlled-shelly-devices/ data-toggle=tooltip data-placement=top title="Audio controlled Shelly devices">&larr; Previous Post</a></li><li class=next><a href=https://bzoltan1.github.io/checking-changelogs-with-zypper/ data-toggle=tooltip data-placement=top title="Checking changelogs with zypper">Next Post &rarr;</a></li></ul></div></div></div><footer><div class=container><div class=row><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center footer-links"><li><a href=mailto:zoltan.balogh@suse.com title="Email me"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://github.com/bzoltan1 title=GitHub><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href=https://linkedin.com/in/zbalogh title=LinkedIn><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="credits copyright text-muted">Zoltán Balogh
&nbsp;&bull;&nbsp;&copy;
2025
&nbsp;&bull;&nbsp;
<a href=https://bzoltan1.github.io/>Zoltán's Blog</a></p><p class="credits theme-by text-muted"><a href=https://gohugo.io>Hugo v0.147.5</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a></p></div></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js integrity=sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script src=https://code.jquery.com/jquery-3.7.0.slim.min.js integrity=sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js integrity=sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd crossorigin=anonymous></script><script src=https://bzoltan1.github.io/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://bzoltan1.github.io/js/load-photoswipe.js></script></body></html>